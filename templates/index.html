{% extends "layout.html" %}

{% block heading %}
{% endblock %}

{% block content %}
<div class="">
    <ul class="space-y-4">
        <li class="bg-white px-4 py-6 shadow sm:p-6 sm:rounded-lg">
            <article >
                <div>
                    <h2 class="mt-4 p-6 text-lg font-normal text-center text-gray-400">
                        Some content
                    </h2>
                </div>
            </article>
        </li>

{#        <div class="container mx-auto pt-10">#}
{#            <div id="add_project">#}
{##}
{#                <button#}
{#                        v-if="!showChoices"#}
{#                        @click="show" type="button"#}
{#                        class="p-1 rounded-md bg-blue-500 text-white hover:bg-blue-400 absolute right-20 mx-5">#}
{#                    Add project#}
{#                </button>#}
{##}
{#                <div v-if="showChoices" class="grid justify-items-center">#}
{#                    <div class="relative place-items-center mt-10 rounded-md bg-gray-100 w-1/3 p-5 ">#}
{#                        <div>Project</div>#}
{#                        <form @submit.prevent="createProject">#}
{#                            <input type="text" v-model="newProject" placeholder="Create project"/>#}
{#                            <button type="submit" class="p-0.5 rounded-md bg-blue-500 text-white hover:bg-blue-400">#}
{#                                Create project#}
{#                            </button>#}
{#                        </form>#}
{##}
{#                        <div>#}
{#                            Channel#}
{#                        </div>#}
{#                        <form @submit.prevent="createChannel">#}
{#                            <input type="text" v-model="newChannel" placeholder="Create channel"/>#}
{#                            <select v-model="selectedProject">#}
{#                                <option value="0" disabled>Select Project</option>#}
{#                                <option v-for="project in projects" :key="project.id" :value="project.id">[[#}
{#                                    project.name ]]#}
{#                                </option>#}
{#                            </select>#}
{#                            <!--                <p>selected project id -> [[ selectedProject ]]</p>-->#}
{#                            <button type="submit"#}
{#                                    class="p-0.5 rounded-md bg-blue-500 text-white hover:bg-blue-400 inline-block">#}
{#                                Create channel#}
{#                            </button>#}
{#                        </form>#}
{##}
{#                        <div>#}
{#                            Token#}
{#                        </div>#}
{#                        <form @submit.prevent="createToken">#}
{#                            <label for="readOnly">Read Only</label>#}
{#                            <input id="readOnly" type="checkbox" v-model="readOnly" placeholder="Create API token"/>#}
{#                            <button type="submit" class="p-0.5 rounded-md bg-blue-500 text-white hover:bg-blue-400">#}
{#                                Create token#}
{#                            </button>#}
{#                        </form>#}
{##}
{#                        <!--                                            <div>Projects: [[ projects ]]</div>-->#}
{#                        <!--                            <p>Tokens: [[ tokens ]]</p>-->#}
{#                        <button#}
{#                                v-if="showChoices"#}
{#                                @click="hide"#}
{#                                class="p-1 rounded-md bg-blue-500 text-white hover:bg-blue-400 absolute right-0 mt-5"#}
{#                        >Hide#}
{#                        </button>#}
{#                    </div>#}
{##}
{#                </div>#}
{##}
{#            </div>#}
{##}
{#            <div class="flex justify-start mx-20 mt-10 mb-5">#}
{#                <select>#}
{#                    <option value="0" disabled>Select Project</option>#}
{#                    <option v-for="project in projects" :key="project.id" :value="project.id">[[ project.name ]]#}
{#                    </option>#}
{#                </select>#}
{#                <select class="mx-5">#}
{#                    <option value="0" disabled>Select Channel</option>#}
{#                    <option v-for="project in projects" :key="project.id" :value="project.channels.id">#}
{#                        [[ project.channels.name]]#}
{#                    </option>#}
{#                </select>#}
{#            </div>#}
{##}
{#            <div class="grid justify-items-center mx-20">#}
{#                <div class="relative rounded-md bg-gray-100 w-full h-60 p-10">#}
{#                    Containers#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
    </ul>
</div>
{% endblock content %}

{% block vuejs %}
<script>
    new Vue({
        el: "#app",

        delimiters: ['[[', ']]'],

        data() {
            return {
                openMobileNav: false,
                projects: [],
                newProject: '',
                newChannel: '',
                selectedProject: 0,
                readOnly: true,
                tokens: [],
                showChoices: true
            }
        },

        methods: {
            logout() {
                fetch("/logout", {method: "POST"}).then(() => {
                    window.location.reload();
                })
            },

            createProject: async function () {
                const data = {
                    name: this.newProject,
                    slug: this.newProject
                }
                const proj = await fetch("/api/v1/projects/", {
                    method: "POST",
                    body: JSON.stringify(data)
                }).then(r => r.json())
                this.projects.push(proj)
                this.newProject = ''
            },

            createChannel() {
                const data = {
                    name: this.newChannel,
                    slug: this.newChannel,
                    project_id: this.selectedProject
                }
                fetch("/api/v1/channels/", {method: "POST", body: JSON.stringify(data)}).then(() => {
                    this.newChannel = ''
                })
            },

            createToken: async function () {
                this.tokens = await fetch(`/api/v1/tokens/?read_only=${this.readOnly}`, {method: "POST"}).then(r => r.json())
                this.readOnly = true
            },

            async getTokens() {
                return await fetch("/api/v1/tokens/").then(r => r.json())
            },

            async getProjects() {
                return await fetch("/api/v1/projects/").then(r => r.json())
            },

            initializeChoices: function () {
                let list = []
                // lets load up our select with many choices
                // so it will use a lot of memory
                for (let i = 0; i < 1000; i++) {
                    list.push({
                        label: "Item " + i,
                        value: i
                    })
                }
                new Choices("#choices-single-default", {
                    searchEnabled: true,
                    removeItemButton: true,
                    choices: list
                })
            },
            show: function () {
                this.showChoices = true
                this.$nextTick(() => {
                    this.initializeChoices()
                })
            },
            hide: function () {
                this.showChoices = false
            }

        },

        mounted: async function () {
            this.projects = await this.getProjects()
            this.tokens = await this.getTokens()
            this.initializeChoices()
        }
    })
</script>
{% endblock %}